// <auto-generated />

#pragma warning disable CS1591
// ReSharper disable RedundantArgumentDefaultValue
// ReSharper disable PartialTypeWithSinglePart
// ReSharper disable RedundantUsingDirective

using System.Diagnostics.CodeAnalysis;
using Microsoft.EntityFrameworkCore.Migrations;

namespace DIGOS.Ambassador.Plugins.Autorole.Migrations
{
    [ExcludeFromCodeCoverage]
    public partial class AddUniqueIndexes : Migration
    {
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            // Remove bad duplicate records
            migrationBuilder.Sql
            (
                "delete from \"AutoroleModule\".\"UserStatistics\" where \"ID\" in (select \"ID\" from (select \"ID\", \"UserID\", row_number() over (partition by \"UserID\" order by \"ID\") as Row from \"AutoroleModule\".\"UserStatistics\") dupes where dupes.Row > 1);"
            );

            migrationBuilder.DropIndex(
                name: "IX_UserStatistics_UserID",
                schema: "AutoroleModule",
                table: "UserStatistics");

            migrationBuilder.DropIndex(
                name: "IX_UserServerStatistics_ServerID",
                schema: "AutoroleModule",
                table: "UserServerStatistics");

            migrationBuilder.CreateIndex(
                name: "IX_UserStatistics_UserID",
                schema: "AutoroleModule",
                table: "UserStatistics",
                column: "UserID",
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_UserServerStatistics_ServerID_UserStatisticsID",
                schema: "AutoroleModule",
                table: "UserServerStatistics",
                columns: new[] { "ServerID", "UserStatisticsID" },
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_UserChannelStatistics_ChannelID_UserServerStatisticsID",
                schema: "AutoroleModule",
                table: "UserChannelStatistics",
                columns: new[] { "ChannelID", "UserServerStatisticsID" },
                unique: true);
        }

        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropIndex(
                name: "IX_UserStatistics_UserID",
                schema: "AutoroleModule",
                table: "UserStatistics");

            migrationBuilder.DropIndex(
                name: "IX_UserServerStatistics_ServerID_UserStatisticsID",
                schema: "AutoroleModule",
                table: "UserServerStatistics");

            migrationBuilder.DropIndex(
                name: "IX_UserChannelStatistics_ChannelID_UserServerStatisticsID",
                schema: "AutoroleModule",
                table: "UserChannelStatistics");

            migrationBuilder.CreateIndex(
                name: "IX_UserStatistics_UserID",
                schema: "AutoroleModule",
                table: "UserStatistics",
                column: "UserID");

            migrationBuilder.CreateIndex(
                name: "IX_UserServerStatistics_ServerID",
                schema: "AutoroleModule",
                table: "UserServerStatistics",
                column: "ServerID");
        }
    }
}

